### CAP√çTULO 7 ‚Äì Integra√ß√£o Web e *Business Intelligence* (BI)

Em um Sistema de Banco de Dados (SBD), a informa√ß√£o armazenada √© essencial para o desenvolvimento de aplica√ß√µes e √© um bem precioso que deve ser guardado de forma coerente e adequada. A capacidade de manipular os dados para gerar relat√≥rios e extrair conhecimento √© o principal objetivo do BD, apoiando a **tomada de decis√£o** em empresas e governos.

üåê **Ferramentas:** Supabase e Power BI

## 7.1 Introdu√ß√£o ao Business Intelligence (BI): A An√°lise Visual de Dados.

O *Business Intelligence* (BI) refere-se ao processo de coleta, organiza√ß√£o, an√°lise, compartilhamento e monitoramento de informa√ß√µes que oferecem suporte √† gest√£o de neg√≥cios. O principal prop√≥sito √© transformar grandes volumes de **dados brutos** em **informa√ß√£o organizada** que gere **conhecimento** e auxilie na tomada de decis√µes.

Embora os Sistemas Gerenciadores de Banco de Dados (SGBD) provejam os mecanismos de controle de dados e consulta (DQL/SELECT), as ferramentas de BI atuam no n√≠vel de abstra√ß√£o mais alto, o **N√≠vel de Vis√£o**, apresentando os dados de forma personalizada e visual.

A an√°lise visual de dados, central ao BI, depende das seguintes capacidades do SGBD:

1.  **M√∫ltiplas Vis√µes dos Dados:** O SGBD suporta m√∫ltiplas vis√µes dos dados, permitindo que cada tipo de usu√°rio ou aplica√ß√£o veja apenas o subconjunto de dados de seu interesse.
2.  **Consultas Complexas:** A capacidade de executar consultas (DQL) de forma eficiente, utilizando cl√°usulas como `JOIN`, `GROUP BY` e fun√ß√µes de agrega√ß√£o (`SUM`, `AVG`, `COUNT`), √© fundamental para sumarizar e consolidar os dados antes da visualiza√ß√£o.

## 7.2 Publicando o Banco no Supabase (DBaaS).

A integra√ß√£o de um BD com a Web e ferramentas de BI frequentemente utiliza uma **Arquitetura Cliente-Servidor de Tr√™s Camadas**, onde o servidor de dados √© isolado por uma camada intermedi√°ria (servidor de aplica√ß√£o ou Web).

Um servi√ßo de *Database as a Service* (DBaaS), como o Supabase, fornece a infraestrutura necess√°ria para hospedar o banco de dados (que pode ser PostgreSQL, conforme a ferramenta deste cap√≠tulo) e automatiza a camada de neg√≥cio. O SGBD, seja ele em um PC, numa grande rede de computadores, ou em um servi√ßo em nuvem, utiliza interfaces para interpretar as informa√ß√µes do aplicativo.

Nesta arquitetura de tr√™s camadas, o DBaaS atua como:

*   **Camada de Dados (Servidor de Dados):** Mant√©m os dados, servindo como reposit√≥rio e executando as solicita√ß√µes da camada de neg√≥cio.
*   **Camada de Neg√≥cio (Servidor de Aplica√ß√£o):** Implementa as regras de neg√≥cio e armazena fun√ß√µes, agindo como intermedi√°rio que acessa os dados e aplica a seguran√ßa.

## 7.3 API REST do Supabase: Acesso ao Banco via Web.

Para permitir que aplica√ß√µes web, mobile ou ferramentas de BI se conectem ao banco de dados hospedado (DBaaS), √© utilizada uma **API (Interface de Programa√ß√£o de Aplicativos)**.

A API REST, gerada automaticamente pelo Supabase (ou ferramenta similar), cumpre o papel de interface, permitindo que clientes (incluindo o Power BI, neste contexto) solicitem, manipulem e consultem dados.

*   **Fun√ß√£o da API:** A API recebe as solicita√ß√µes da camada de apresenta√ß√£o (o cliente/usu√°rio) e as envia para o SGBD. Ela lida com a complexidade do acesso, manipula√ß√£o e organiza√ß√£o dos dados, traduzindo as requisi√ß√µes HTTP em comandos SQL (DQL/DML) que o banco de dados executa.
*   **Seguran√ßa (DCL):** O DBA (ou, neste caso, a plataforma DBaaS) utiliza comandos DCL (Linguagem de Controle de Dados) para criar regras de seguran√ßa, assegurando que a API apenas permita o acesso adequado, restringindo o acesso n√£o-autorizado.

## 7.4 Conex√£o com Power BI e An√°lise Descritiva de Dados.

O Power BI (como ferramenta de BI) conecta-se √† fonte de dados (o SGBD PostgreSQL, seja diretamente ou via API REST do Supabase) para realizar a an√°lise descritiva.

1.  **Extra√ß√£o de Dados (SELECT):** A ferramenta utiliza consultas `SELECT` para extrair os registros necess√°rios. Para an√°lise, √© comum utilizar o `SELECT` em conjunto com fun√ß√µes de agrega√ß√£o, como `AVG` (m√©dia) e `SUM` (soma), e jun√ß√µes (`JOIN`) para ligar informa√ß√µes de tabelas distribu√≠das.
2.  **Otimiza√ß√£o:** Para que a extra√ß√£o de dados seja eficiente, o SGBD deve prover estruturas de busca adequadas. A otimiza√ß√£o atrav√©s de **√≠ndices** acelera a busca.
3.  **Filtragem e Agrupamento:** A an√°lise descritiva frequentemente emprega a cl√°usula `GROUP BY` para particionar os dados em subgrupos, e a cl√°usula `HAVING` para impor condi√ß√µes sobre esses grupos, permitindo, por exemplo, analisar o somat√≥rio de vendas apenas para clientes que ultrapassaram um certo limite.

## 7.5 Criando Dashboards e Relat√≥rios Visuais.

Dashboards e relat√≥rios visuais s√£o a materializa√ß√£o do **N√≠vel de Vis√£o**. Eles apresentam os dados armazenados no BD, de acordo com a necessidade do usu√°rio.

*   **Vantagem da Visualiza√ß√£o:** O relat√≥rio visual simplifica a intera√ß√£o com o sistema e permite que o usu√°rio veja apenas o que √© necess√°rio.
*   **Views (Vis√µes):** Antes da visualiza√ß√£o, pode-se usar o comando `CREATE VIEW` para salvar uma consulta complexa como uma tabela virtual. Isso simplifica as consultas subsequentes que a ferramenta de BI far√°, pois ela ir√° consultar a *view* ao inv√©s de refazer toda a l√≥gica de `JOINs` e agrupamentos. Uma *view* pode descrever apenas partes dos dados, oferecendo uma vers√£o personalizada das tabelas.

## 7.6 ESTUDO DE CASO: Painel de Empr√©stimos da Biblioteca e Visualiza√ß√£o no Power BI. (Pr√°tica relacionada ao conte√∫do do cap√≠tulo no contexto do sistema da biblioteca.)

No contexto da Biblioteca, o Painel de Empr√©stimos (Dashboard) visa fornecer informa√ß√µes cruciais para a gest√£o, como quais s√£o os livros mais populares e o hist√≥rico de atrasos.

**1. Prepara√ß√£o dos Dados (Consultas SQL/Views):**
O SGBD executa consultas complexas baseadas no Modelo Relacional da Biblioteca:

*   **Relat√≥rio de Popularidade (Fun√ß√µes de Agrega√ß√£o):** Uma consulta contaria (`COUNT`) o n√∫mero de vezes que cada livro foi emprestado, agrupando pelo t√≠tulo do livro, como visto anteriormente no Cap√≠tulo 5.
    ```sql
    -- Exemplo Conceitual de View para Popularidade
    CREATE VIEW V_LIVROS_POPULARES AS
    SELECT L.Titulo, COUNT(E.Codigo_Livro) AS Total_Emprestimos
    FROM LIVRO AS L JOIN EMPRESTIMO AS E ON L.Codigo = E.Codigo_Livro
    GROUP BY L.Titulo;
    ```
*   **Relat√≥rio de Atrasos (Filtragem e Jun√ß√£o):** Uma consulta identificaria os registros na tabela `EMPRESTIMO` onde a data de devolu√ß√£o real √© posterior √† data prevista (ou quando a data prevista j√° passou e a data real √© nula).

**2. Conex√£o e An√°lise (Power BI):**
A ferramenta Power BI se conecta √† fonte de dados (PostgreSQL/Supabase) e consome os resultados dessas consultas (diretamente ou via `VIEWs`).

**3. Visualiza√ß√£o (Dashboard):**
O painel visualizaria os dados:

*   **Gr√°fico de Barras:** Exibindo os livros mais populares, baseando-se na `V_LIVROS_POPULARES` e ordenados de forma descendente.
*   **Cart√µes (Cards):** Mostrando a m√©dia (`AVG`) de dias de atraso ou o n√∫mero total (`COUNT`) de atrasos no m√™s, utilizando fun√ß√µes de agrega√ß√£o.

Este painel fornece aos administradores do sistema da biblioteca a **informa√ß√£o** necess√°ria para apoiar a decis√£o sobre recompra de t√≠tulos ou altera√ß√£o de pol√≠ticas de empr√©stimo.

## 7.7 EXERC√çCIOS COMPLEMENTARES: Conex√£o com Power BI usando dados de um dom√≠nio complementar. (Exerc√≠cios para fixa√ß√£o de conceitos e exerc√≠cios pr√°ticos do cap√≠tulo sobre outros dom√≠nios de problemas.)

Utilizando o dom√≠nio de **An√°lise de Vendas de um E-commerce** (conforme os exemplos do Cap√≠tulo 5), realize as seguintes pr√°ticas:

1.  **Cria√ß√£o de View para An√°lise de Alto Valor:**
    Crie uma *VIEW* (Vis√£o) chamada `V_CLIENTES_VALOR` que liste o nome, CPF e o valor total (`SUM`) gasto por cada cliente, mas **apenas** para aqueles clientes que gastaram mais de R$ 5.000,00 (`HAVING`).

2.  **Simula√ß√£o de Visualiza√ß√£o:**
    Explique como uma ferramenta de BI (Power BI) usaria esta *VIEW* para criar um gr√°fico de rosca que exiba a propor√ß√£o de gasto de cada cliente de alto valor em rela√ß√£o ao total gasto por todos os clientes de alto valor.

3.  **√çndices e Performance (Modelo F√≠sico):**
    Assumindo que a tabela `CLIENTE` possui milh√µes de registros e a filtragem da `VIEW` (pelo CPF) est√° lenta. Proponha um ajuste no **Modelo F√≠sico** (Cap√≠tulo 6) para otimizar o desempenho de consulta dessa *VIEW*, utilizando o comando DDL adequado.